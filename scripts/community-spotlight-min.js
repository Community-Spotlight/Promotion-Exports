window.CSPromos={};const base="https://raw.githubusercontent.com/Community-Spotlight/";async function refreshPromos(){try{let e=await fetch(`${base}promotion-index/main/index.json`);if(!e.ok)throw Error("Couldn't fetch promotions!");window.CSPromos=await e.json()}catch(t){console.error(t)}}function getPromotion(e,t){let o=e=>e[Math.floor(Math.random()*e.length)];e="video"===e?"video":"image",t="object"==typeof t?t:{};let i={...window.CSPromos};t.tags&&t.tags.length>0&&(i=Object.fromEntries(Object.entries(i).filter(([e,o])=>o.tags.some(e=>t.tags.includes(e.toLowerCase())))));let n=Object.keys(i).filter(t=>{let o=i[t].media;return"image"===e?o.images.length>0:o.videos.length>0});if(0===n.length)return console.warn("CS -- No promotions found with given parameters"),{};let r,s,a=0,l=[...n];for(;a<n.length;){let m=o(l);r=i[m],l.splice(l.indexOf(m),1);let g=r.media;if("image"===e){let d=g.images.find(e=>!t.aspectRatio||e.size===t.aspectRatio);s=d?`${d.size}.${d.type}`:null}else if("video"===e){let f=g.videos.find(e=>(!t.aspectRatio||e.size===t.aspectRatio)&&(!t.videoLength||e.length===t.videoLength));s=f?`sz${f.size.replace(":","x")}leng${f.length}.${f.type}`:null}if(s)break;a++}if(!s)return console.warn("CS -- No promotions found with given parameters"),{};let h={...r};return delete h.media,{...h,url:`${base}promotion-media/main/${encodeURIComponent(h.id)}/${s}`}}
