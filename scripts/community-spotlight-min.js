window.CSPromos={};const base="https://raw.githubusercontent.com/Community-Spotlight/";async function refreshPromos(){try{let e=await fetch(`${base}promotion-index/main/index.json`);if(!e.ok)throw Error("Couldn't fetch promotions!");window.CSPromos=await e.json()}catch(t){console.error(t)}}function getPromotion(e,t){let o=e=>e[Math.floor(Math.random()*e.length)];e="video"===e?"video":"image",t="object"==typeof t?t:{};let i=window.CSPromos;t.tags&&t.tags.length>0&&(i=Object.fromEntries(Object.entries(i).filter(([e,o])=>o.tags.some(e=>t.tags.includes(e.toLowerCase())))));let n=Object.keys(i).filter(t=>{let o=i[t];return"image"===e?Object.keys(o.media.images).length>0:"video"===e&&o.media.videos.length>0});if(0===n.length)return console.warn("CS -- No promotions found for the given parameters"),{};let r,s,a=0;for(;a<n.length;){let l=o(n);r=i[l];let m=r.media;if("image"===e){let g=Object.keys(m.images),d=t.aspectRatio||o(g);s=(s=g.includes(d)?d:null)?`${s}.${m.images[s].type.toLowerCase()}`:null}else if("video"===e){let f=m.videos,h=f.find(e=>(!t.aspectRatio||e.size===t.aspectRatio)&&(!t.videoLength||e.length===t.videoLength));s=h?`sz${h.size.replace(":","x")}leng${h.length}.${h.type.toLowerCase()}`:null}if(s)break;a++}if(!s)return console.warn("CS -- No promotions found for the given parameters"),{};let u={...r};return delete u.media,{...u,url:`${base}promotion-media/main/${e}s/${u.id}/${s}`}}
